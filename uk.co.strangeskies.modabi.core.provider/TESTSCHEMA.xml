<?xml version="1.0" ?>
<schema
  xmlns="http://modabi.strangeskies.co.uk/2014-01-01/"
  name="ScriptingSchema">

  <dependencies>
    BaseSchema
  </dependencies>

  <imports>
    java.lang.Object,

    javax.script.ScriptEngineManager,
    javax.script.ScriptEngine,
    javax.script.Invocable,

    uk.co.strangeskies.reflection.token.TypeToken,
    uk.co.strangeskies.reflection.token.TypeToken.Infer,

    uk.co.strangeskies.modabi.scripting.ScriptObject,
    uk.co.strangeskies.modabi.scripting.ScriptObjectBuilder,
    uk.co.strangeskies.modabi.processing.ProcessingContext,
    uk.co.strangeskies.modabi.schema.Model
  </imports>

  <types />

  <models>
    <model
      name="scriptObject"
      type="@Infer ?"
      abstractness="ABSTRACT">

      <bind input="provide(ScriptObjectBuilder.class)" />

      <bind
        name="objectName"
        condition="?"
        model="string" />

      <bind
        name="script"
        type="string">

        <condition>
          <optional />
        </condition>

        <content />
      </bind>

      <bind
        name="resource"
        type="string">

        <condition>
          <isNotBound binding="script" />
        </condition>

        <property />
      </bind>

      <bind
        name="language"
        type="string">

        <condition>
          <or>
            <isBound binding="script" />
            <and>
              <isNotBound binding="script" />
              <optional />
            </and>
          </or>
        </condition>

        <property />
      </bind>

      <bindInput
        name="create"
        chainedInput="true" />

      <inputSequence
        name="cast"
        chainedInput="true" />

      <!-- TEST FORM OF REFERENCES: -->
      <!-- expected -->
      <bind model="reference">
        <data>
          <bind name="targetModel">someModel</bind>

          <bind name="targetId">id</bind>

          <value>123</value>
        </data>
      </bind>

      <!-- better? -->
      <bind model="reference">
        <data>
          <value
            targetModel="hello"
            targetId="name">

            theName
          </value>
        </data>
      </bind>

      <!-- better??? -->
      <bind model="reference">
        <value
          targetModel="hello"
          targetId="name">
          theName
        </value>
      </bind>

      <!-- alternative collapse??? -->
      <bind model="reference">
        <data
          targetModel="hello"
          targetId="name">

          theName
        </data>
      </bind>

      <!-- ideal -->
      <bind
        model="reference"
        targetModel="hello"
        targetId="name">

        theName
      </bind>
    </model>
  </models>
</schema>
