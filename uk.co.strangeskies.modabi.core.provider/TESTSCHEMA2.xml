<?xml version="1.0" ?>
<schema
  xmlns="http://modabi.strangeskies.co.uk/2014-01-01/"
  xmlns:sai="http://saiman.co.uk/2015-10-08/"
  name="sai:PeriodicTableSchema">

  <imports>
    uk.co.strangeskies.reflection.token.TypeToken.Infer,
    java.util.Collection,
    java.util.List,
    uk.co.saiman.chemistry.Element.Group,
    uk.co.saiman.chemistry.PeriodicTable,
    uk.co.saiman.chemistry.Element,
    uk.co.saiman.chemistry.isotope.Isotope
  </imports>

  <dependencies>
    BaseSchema
  </dependencies>

  <types />

  <models>
    <model
      name="sai:isotope"
      dataType="Isotope"
      pattern="[ $sai:massNumber ; $sai:mass ; $sai:abundance ]">

      <bind
        name="sai:massNumber"
        input=""
        model="int" />

      <bind
        name="sai:mass"
        input=""
        model="double" />

      <bind
        name="sai:abundance"
        input=""
        model="double" />

      <bind input="new Isotope($sai:massNumber, $sai:mass, $sai:abundance)" />
    </model>

    <model
      name="sai:element"
      dataType="Element">

      <bind input="new Element()" />

      <bind
        name="sai:atomicNumber"
        model="int"
        input="target = target.withAtomicNumber($)" />

      <bind
        name="sai:name"
        model="string"
        condition="optional"
        input="target = target.withName($)" />

      <bind
        name="sai:symbol"
        model="string"
        input="target = target.withSymbol($)" />

      <bind
        model="sai:isotope"
        condition="occurrences(Range.from(0))"
        output=".getIsotopes()[]"
        input="target = target.withIsotope($[])" />

      <bind
        name="sai:group"
        model="enum"
        dataType="Group"
        input="taret = target.withGroup($)" />
    </model>

    <model
      name="sai:periodicTable"
      dataType="PeriodicTable">

      <bind input="new PeriodicTable()" />

      <bind
        name="sai:name"
        model="string" />

      <bind
        model="sai:element"
        output="source.getElements()[]"
        input="target.getElements().add($)">

        <condition>
          <occurrences range="0.." />
        </condition>
      </bind>
    </model>
  </models>
</schema>
