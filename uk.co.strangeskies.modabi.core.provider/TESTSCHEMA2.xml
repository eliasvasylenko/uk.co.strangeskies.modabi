<?xml version="1.0" ?>
<schema
  xmlns="http://modabi.strangeskies.co.uk/2014-01-01/"
  xmlns:sai="http://saiman.co.uk/2015-10-08/"
  name="sai:PeriodicTableSchema">

  <imports>
    uk.co.strangeskies.reflection.token.TypeToken.Infer,
    java.util.Collection,
    java.util.List,
    uk.co.saiman.chemistry.Element.Group,
    uk.co.saiman.chemistry.PeriodicTable,
    uk.co.saiman.chemistry.Element,
    uk.co.saiman.chemistry.isotope.Isotope
  </imports>

  <dependencies>
    BaseSchema
  </dependencies>

  <types />

  <models>
    <model
      name="sai:isotope"
      dataType="Isotope"
      initializeInput="new Isotope($sai:massNumber, $sai:mass, $sai:abundance)">

      <!-- That the above initializeInput works might seem counter intuitive 
        at first, but it should be okay. Input must be in order, but binding doesn't 
        have to be, so this input can be delayed until the following items are bound, 
        as they have blank input sections. -->

      <bind
        name="sai:massNumber"
        input="">
        <property model="int" />
      </bind>

      <bind
        name="sai:mass"
        input="">
        <property model="double" />
      </bind>

      <bind
        name="sai:abundance"
        input="">
        <property model="double" />
      </bind>

      <!-- an alternative to the initialize input section -->
      <bind
        model="void"
        input="new Isotope($sai:massNumber, $sai:mass, $sai:abundance)" />
    </model>

    <!-- Skip the 'dataType' attribute to say that it is inferred (and resolved) 
      automatically based on the sequence of child binding points. The problem 
      with this is that output of binding points can't be resolved before knowing 
      this... damn... -->
    <model
      name="sai:element"
      initializeInput="new Element()">

      <!-- an alternative to the initialize input section -->
      <bind
        model="void"
        input="new Element()" />

      <bind
        name="sai:atomicNumber"
        model="int"
        input=".=withAtomicNumber($)" />

      <bind
        name="sai:name"
        model="string"
        condition="optional"
        input=".=withName($)" />

      <bind
        name="sai:symbol"
        model="string"
        input=".=withSymbol($)" />

      <bind
        model="sai:isotope"
        condition="occurrences(Range.from(0))"
        output=".getIsotopes()[]"
        input="target = target.withIsotope($)" />

      <bind
        name="sai:group"
        model="enum"
        dataType="Group"
        input="taret = target.withGroup($)" />
    </model>

    <model
      name="sai:periodicTable"
      initializeInput="new PeriodicTable()">

      <!-- an alternative to the initialize input section -->
      <bind
        model="void"
        input="new PeriodicTable()" />

      <bind
        name="sai:name"
        model="string" />

      <bind
        model="sai:element"
        output="source.getElements()[]"
        input="target.getElements().add($)">

        <condition>
          <occurrences range="0.." />
        </condition>
      </bind>
    </model>
  </models>
</schema>
